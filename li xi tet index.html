<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>B·ªëc ThƒÉm L√¨ X√¨ T·∫øt</title>
<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;min-height:100vh;background:radial-gradient(circle at 20% 20%, #ff4d4d, #990000);color:#fff;display:flex;align-items:center;justify-content:center;overflow:hidden}
.wrap{display:grid;grid-template-columns:1fr;gap:12px;width:100%;max-width:460px;padding:14px}
h1{margin:6px 0;text-align:center}
.card{background:rgba(255,255,255,.12);border-radius:14px;padding:12px}
.row{display:flex;gap:8px}
input{flex:1;padding:10px;border-radius:10px;border:0}
.envelope{width:220px;height:300px;margin:10px auto;position:relative;background:linear-gradient(#c40000,#e60000);border-radius:14px;cursor:pointer;box-shadow:0 18px 40px rgba(0,0,0,.35)}
.flap{position:absolute;width:100%;height:140px;background:linear-gradient(#ff1a1a,#ff3333);clip-path:polygon(0 0,50% 100%,100% 0);transform-origin:top;transition:transform .7s ease;border-top-left-radius:14px;border-top-right-radius:14px}
.envelope.open .flap{transform:rotateX(180deg)}
.money-slot{position:absolute;left:16px;right:16px;top:96px;height:120px;display:flex;align-items:center;justify-content:center}
.note{width:100%;height:100%;border-radius:10px;background:#0a8f3e center/cover no-repeat;box-shadow:0 10px 20px rgba(0,0,0,.4);opacity:0;transform:translateY(30px) scale(.95);transition:all .6s ease .35s}
.envelope.open .note{opacity:1;transform:translateY(0) scale(1)}
.amount{text-align:center;font-weight:700;font-size:22px}
.total{text-align:center}
ul{list-style:none;margin:0;padding:0}
li{display:flex;justify-content:space-between;padding:6px 8px;background:rgba(0,0,0,.2);border-radius:8px;margin:6px 0}
#fw{position:fixed;inset:0;pointer-events:none}
</style>
</head>
<body>
<canvas id="fw"></canvas>
<div class="wrap">
  <h1>üßß L√¨ X√¨ May M·∫Øn</h1>
  <div class="card">
    <div class="row">
      <input id="name" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n" />
      <button onclick="checkClaim()">Ki·ªÉm tra</button>
    </div>
    <div class="envelope" id="envelope">
      <div class="flap"></div>
      <div class="money-slot"><div class="note" id="note"></div></div>
    </div>
    <div class="amount" id="amount">???</div>
    <div class="total" id="total">T·ªïng ti·ªÅn ƒë√£ ph√°t: 0ƒë</div>
  </div>
  <div class="card">
    <b>üèÜ B·∫£ng x·∫øp h·∫°ng may m·∫Øn</b>
    <ul id="leaderboard"></ul>
  </div>
</div>
<script>
// ===== C·∫§U H√åNH SERVER =====
// T·∫°o 1 API ƒë∆°n gi·∫£n (Firebase / Apps Script) r·ªìi thay URL n√†y
const API_BASE = 'https://example.com/lixi';

const NOTES={
  2000:'https://upload.wikimedia.org/wikipedia/commons/8/83/Vietnam_2000_dong_2003_obverse.jpg',
  5000:'https://upload.wikimedia.org/wikipedia/commons/0/0b/Vietnam_5000_dong_2003_obverse.jpg',
  10000:'https://upload.wikimedia.org/wikipedia/commons/6/6c/Vietnam_10000_dong_2003_obverse.jpg',
  20000:'https://upload.wikimedia.org/wikipedia/commons/7/70/Vietnam_20000_dong_2006_obverse.jpg',
  50000:'https://upload.wikimedia.org/wikipedia/commons/1/1b/Vietnam_50000_dong_2003_obverse.jpg',
  100000:'https://upload.wikimedia.org/wikipedia/commons/3/35/Vietnam_100000_dong_2004_obverse.jpg'
};
// Jackpot c·ª±c hi·∫øm
const WEIGHTS={2000:50,5000:30,10000:12,20000:6,50000:2,100000:1};

const env=document.getElementById('envelope');
const note=document.getElementById('note');
const amountEl=document.getElementById('amount');
const totalEl=document.getElementById('total');
const lb=document.getElementById('leaderboard');

function fmt(v){return Number(v).toLocaleString('vi-VN')+'ƒë'}

async function sha256(text){
  const enc=new TextEncoder().encode(text);
  const buf=await crypto.subtle.digest('SHA-256',enc);
  return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('');
}

function weightedPick(){
  const e=Object.entries(WEIGHTS);
  let t=e.reduce((s,[,w])=>s+Number(w),0);
  let r=Math.random()*t;
  for(const [v,w] of e){r-=w;if(r<=0)return Number(v)}
  return Number(e[0][0]);
}

async function checkClaim(){
  const name=document.getElementById('name').value.trim();
  if(!name)return alert('Nh·∫≠p t√™n tr∆∞·ªõc');
  const hash=await sha256(name);
  const res=await fetch(API_BASE+'/check?hash='+hash);
  const data=await res.json();
  if(data.claimed){
    env.classList.add('open');
    note.style.backgroundImage=`url(${NOTES[data.amount]})`;
    amountEl.textContent=fmt(data.amount);
    env.style.cursor='not-allowed';
  }
  loadStats();
}

env.addEventListener('click',async()=>{
  const name=document.getElementById('name').value.trim();
  if(!name)return alert('Nh·∫≠p t√™n tr∆∞·ªõc');
  const hash=await sha256(name);
  const check=await fetch(API_BASE+'/check?hash='+hash).then(r=>r.json());
  if(check.claimed)return alert('B·∫°n ƒë√£ nh·∫≠n l√¨ x√¨ r·ªìi');
  const v=weightedPick();
  note.style.backgroundImage=`url(${NOTES[v]})`;
  amountEl.textContent=fmt(v);
  env.classList.add('open');
  fireworks();
  await fetch(API_BASE+'/claim',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,hash,amount:v,ts:Date.now()})});
  loadStats();
});

async function loadStats(){
  const s=await fetch(API_BASE+'/stats').then(r=>r.json());
  totalEl.textContent='T·ªïng ti·ªÅn ƒë√£ ph√°t: '+fmt(s.total||0);
  lb.innerHTML='';
  (s.top||[]).forEach(i=>{
    const li=document.createElement('li');
    li.innerHTML=`<span>${i.name}</span><b>${fmt(i.amount)}</b>`;
    lb.appendChild(li);
  });
}

// fireworks
const c=document.getElementById('fw');const ctx=c.getContext('2d');
function rs(){c.width=innerWidth;c.height=innerHeight}addEventListener('resize',rs);rs();
let ps=[];function fireworks(){for(let i=0;i<80;i++)ps.push({x:c.width/2,y:c.height/2,vx:Math.random()*6-3,vy:Math.random()*6-3,l:60})}
(function tick(){ctx.clearRect(0,0,c.width,c.height);ps=ps.filter(p=>p.l>0);ps.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=.03;p.l--;ctx.globalAlpha=p.l/60;ctx.fillStyle='gold';ctx.beginPath();ctx.arc(p.x,p.y,2,0,6.28);ctx.fill()});ctx.globalAlpha=1;requestAnimationFrame(tick)})();
loadStats();
</script>
</body>
</html>
